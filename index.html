<!doctype html>
<html lang="es">
<head>
 <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Cartas ðŸ’Œ</title>
<meta name="theme-color" content="#ffd6e7">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Cartas ðŸ’Œ">

<!-- iOS usa esto. Ruta RELATIVA para que funcione en /usuario/REPO/ -->
<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png?v=4">
<link rel="apple-touch-icon" href="./apple-touch-icon.png?v=4"> <!-- fallback -->


  <style>
    :root{
      --bg:#fff7fb; --card:#ffffffee; --pink:#ff8fc1; --pink2:#ff5aa6;
      --text:#524252; --muted:#867585; --ring:#ffc5df;
      --radius:18px; --shadow:0 10px 30px rgba(255,90,166,.18);
      --space: clamp(12px, 2.8vw, 18px);
      --space-lg: clamp(16px, 4vw, 26px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      -webkit-text-size-adjust: 100%;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% -10%, #ffe4f1, transparent 60%),
        radial-gradient(900px 500px at 110% 10%, #fff0f9, transparent 60%),
        var(--bg);
      /* safe areas iPhone */
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }

    /* SPLASH mejorado para mÃ³viles */
    .splash{
      position:fixed; inset:0; z-index:10; display:grid; place-items:center;
      min-height:100dvh; /* evita el bug de 100vh en iOS */
      background:var(--bg);
      transition:opacity .45s ease, visibility .45s ease;
    }
    .splash.hide{opacity:0; visibility:hidden}
    .splash-card{
      width:min(92vw, 520px);
      padding: var(--space-lg);
      text-align:center;
      background:var(--card);
      border:1px solid #ffd9ea; border-radius:22px; box-shadow:var(--shadow);
    }
    .splash h1{
      margin:0 0 6px;
      color:var(--pink2);
      font-size: clamp(22px, 6.5vw, 28px);
      text-wrap: balance;
    }
    .splash p{margin:0 0 var(--space); color:var(--muted); font-size:clamp(14px,3.8vw,16px)}
    .btn{
      background:linear-gradient(180deg,var(--pink),var(--pink2));
      color:#fff; border:none; border-radius:999px;
      padding: 12px 20px; font-weight:700; box-shadow:var(--shadow);
      touch-action: manipulation;
      min-height: 44px; /* tamaÃ±o tÃ¡ctil recomendado */
    }

    /* TOPBAR sticky con notch-safe */
    header.topbar{
      position:sticky; top:0; z-index:5;
      background:#fff; border-bottom:1px solid #ffe0ef;
      padding: calc(env(safe-area-inset-top) + 8px) var(--space) 8px;
    }
    .brand{
      font-weight:800; color:var(--pink2);
      text-align:center; font-size: clamp(16px, 4.8vw, 18px);
    }

    /* LAYOUT mÃ³vil-first */
    .container{
      width:100%;
      max-width: 820px;
      margin: var(--space) auto calc(var(--space-lg) * 2);
      padding-inline: max(var(--space), env(safe-area-inset-left));
    }
    .card{
      background:var(--card);
      border:1px solid #ffd9ea;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding: var(--space);
    }
    h2{
      margin: 4px 0 var(--space);
      color:#c05086;
      font-size: clamp(18px, 5.6vw, 22px);
      text-wrap: balance;
    }

    /* LISTA de cartas optimizada para lectura */
    .listado{display:grid; gap: clamp(10px,3.2vw,14px)}
    .item{
      padding: clamp(12px,3.6vw,16px);
      border:1px solid #ffe0ef; border-radius:14px; background:#fff;
    }
    .item h3{
      margin:0 0 6px; color:#c05086; font-weight:700;
      font-size: clamp(16px, 4.8vw, 18px);
      line-height:1.2; text-wrap: balance;
    }
    .meta{color:#8a7a8a; font-size: clamp(12px,3.8vw,14px)}
    .contenido{
      margin-top: 6px;
      line-height: 1.75;
      font-size: clamp(15px, 4.6vw, 17px);
      white-space: pre-wrap;
      word-break: break-word; /* evita overflow en palabras largas */
    }

    .footer{
      padding: calc(var(--space-lg) + env(safe-area-inset-bottom)) var(--space);
      text-align:center; color:var(--muted);
      font-size: clamp(12px,3.6vw,14px);
    }

    /* Mejoras tÃ¡ctiles / accesibilidad */
    :focus-visible{outline: 3px solid var(--ring); outline-offset: 2px; border-radius:10px}
    a,button{ -webkit-tap-highlight-color: transparent }

    /* Pantallas muy pequeÃ±as */
    @media (max-width: 380px){
      .splash-card{padding: 14px}
      .item{padding: 12px}
    }

    /* Reduce motion: desactiva transiciones */
    @media (prefers-reduced-motion: reduce){
      .splash{transition:none}
    }
  </style>
</head>
<body>
  <!-- Splash -->
  <div class="splash" id="splash">
    <div class="splash-card">
      <h1>Feliz cumple, amorcito</h1>
      <p>(tÃ³came para abrir)</p>
      <button id="openBtn" class="btn">Abrir</button>
    </div>
  </div>

  <header class="topbar">
    <div class="brand">Cartas ðŸ’Œ</div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Tus cartas</h2>
      <div id="listado" class="listado"></div>
      <p class="meta" id="estado">Cargandoâ€¦</p>
    </section>
  </main>

  <footer class="footer">Hecho con ðŸ’— por SrYulo</footer>

  <script>
    // ðŸ‘‰ PONÃ‰ ACÃ EL RAW URL DE TU GIST SECRETO:
    const FEED_URL = "https://gist.githubusercontent.com/Int-Code-UY/ee642cb9278f57311196c31e500e28df/raw/cartas.json";
    
    // Splash
    const splash = document.getElementById('splash');
    const openBtn = document.getElementById('openBtn');
    openBtn.addEventListener('click', ()=> splash.classList.add('hide'));
    splash.addEventListener('click', (e)=>{ if(e.target===splash) splash.classList.add('hide'); });

    const listado = document.getElementById('listado');
    const estado = document.getElementById('estado');

    async function cargarCartas(){
      try{
        const res = await fetch(FEED_URL, { cache: 'no-cache' });
        if(!res.ok) throw new Error('No pude leer el feed');
        const cartas = await res.json();
        listado.innerHTML = '';
        cartas.forEach(c => {
          const item = document.createElement('div');
          item.className = 'item';
          item.innerHTML = `
            <h3>${esc(c.titulo || 'Sin tÃ­tulo')}</h3>
            <div class="meta">${esc(formatearFecha(c.fecha))}</div>
            <div class="contenido">${renderContenido(c.contenido)}</div>
          `;
          listado.appendChild(item);
        });
        estado.textContent = cartas.length ? '' : 'AÃºn no hay cartas';
      }catch(err){
        estado.textContent = 'Sin conexiÃ³n o feed no disponible.';
        console.error(err);
      }
    }

    function esc(s){ return String(s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function renderContenido(s){ return esc(String(s ?? '')).replace(/\n/g,'<br>'); }
    function formatearFecha(f){
      if(!f) return '';
      const d = new Date(f);
      if(Number.isNaN(d.getTime())) return f;
      return d.toLocaleDateString('es-UY', { year:'numeric', month:'long', day:'numeric' });
    }

    cargarCartas();
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) cargarCartas(); });

    // PWA ligero para â€œAgregar a pantalla de inicioâ€ y cache del shell
    if('serviceWorker' in navigator){
      const code = `
        const C='carta-shell-v2';
        self.addEventListener('install',e=>{e.waitUntil(caches.open(C).then(c=>c.addAll(['./','./index.html'])));});
        self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(keys=>Promise.all(keys.map(k=>k!==C&&caches.delete(k)))));});
        self.addEventListener('fetch',e=>{
          const u=new URL(e.request.url);
          if(u.origin===location.origin){ e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))); }
        });
      `;
      const blob = new Blob([code], {type:'text/javascript'});
      const url = URL.createObjectURL(blob);
      navigator.serviceWorker.register(url);
    }
  </script>
</body>
</html>





