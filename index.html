<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cartitas</title>
  <link rel="apple-touch-icon" href="./apple-touch-icon.png?v=12">
  <link rel="icon" href="./apple-touch-icon.png?v=12">
  <meta name="theme-color" content="#ffd6e7">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    :root{
      /* üíó Paleta rom√°ntica */
      --bg:#fff5fb;
      --card:#ffffffee;

      --pink:#ff8fc1;
      --pink2:#ff5aa6;
      --rose:#ffd1e6;
      --lilac:#f3d6ff;

      --text:#4a2f40;
      --muted:#7a5b6c;

      --ring: rgba(255,90,166,.35);

      --radius:18px;
      --shadow:0 12px 34px rgba(255,90,166,.12);

      --space: clamp(12px, 2.8vw, 18px);
      --space-lg: clamp(16px, 4vw, 26px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      -webkit-text-size-adjust: 100%;
      color:var(--text);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      overflow-x:hidden;

      /* üíï Fondo rom√°ntico suave */
      background:
        radial-gradient(900px 520px at 12% -12%, rgba(255,143,193,.28), transparent 60%),
        radial-gradient(900px 520px at 110% 12%, rgba(243,214,255,.35), transparent 62%),
        radial-gradient(1100px 700px at 50% 120%, rgba(255,209,230,.35), transparent 60%),
        var(--bg);
    }

    /* Corazoncitos sutiles (sin im√°genes) */
    body::before{
      content:"";
      position:fixed;
      inset:-40px;
      pointer-events:none;
      z-index:0;
      opacity:.35;
      filter: blur(.2px);
      background:
        radial-gradient(circle at 12% 18%, rgba(255,90,166,.25) 0 2px, transparent 3px),
        radial-gradient(circle at 30% 72%, rgba(255,143,193,.22) 0 1.8px, transparent 3px),
        radial-gradient(circle at 55% 35%, rgba(243,214,255,.22) 0 2px, transparent 3px),
        radial-gradient(circle at 78% 58%, rgba(255,209,230,.22) 0 1.9px, transparent 3px),
        radial-gradient(circle at 92% 18%, rgba(255,90,166,.22) 0 2.1px, transparent 3px);
      animation: floaty 14s ease-in-out infinite;
    }

    @keyframes floaty{
      0%{ transform: translateY(-8px); }
      50%{ transform: translateY(10px); }
      100%{ transform: translateY(-8px); }
    }

    /* Capa base para que todo quede arriba del ‚Äúbefore‚Äù */
    body > *{ position:relative; z-index:1; }

    .splash{
      position:fixed; inset:0; z-index:10; display:grid; place-items:center;
      min-height:100dvh;
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
      backdrop-filter: blur(10px);
      transition:opacity .45s ease, visibility .45s ease;
      padding: var(--space);
    }
    .splash.hide{opacity:0; visibility:hidden}

    .splash-card{
      width:min(92vw, 520px);
      padding: var(--space-lg);
      text-align:center;
      background:var(--card);
      border:1px solid rgba(255,90,166,.14);
      border-radius:22px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }

    /* Borde rom√°ntico arriba */
    .splash-card::before{
      content:"";
      position:absolute;
      inset:0 0 auto 0;
      height:10px;
      background: linear-gradient(90deg, var(--pink2), var(--rose), var(--lilac), var(--rose), var(--pink2));
      opacity:.95;
    }

    .splash h1{
      margin:10px 0 6px;
      color:var(--pink2);
      font-size: clamp(22px, 6.5vw, 28px);
      text-wrap: balance;
      letter-spacing:.2px;
    }
    .splash p{
      margin:0 0 var(--space);
      color:var(--muted);
      font-size:clamp(14px,3.8vw,16px)
    }

    /* Bot√≥n rom√°ntico */
    .btn{
      background: linear-gradient(180deg, var(--pink), var(--pink2));
      color:#fff;
      border:none;
      border-radius:999px;
      padding: 12px 20px;
      font-weight:800;
      box-shadow: 0 12px 28px rgba(255,90,166,.22);
      touch-action: manipulation;
      min-height: 44px;
      position:relative;
      overflow:hidden;
    }
    .btn::after{
      content:"";
      position:absolute;
      inset:-40% -20%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 35%);
      transform: rotate(12deg);
      opacity:.65;
    }
    .btn:active{ transform: translateY(1px); }

    header.topbar{
      position:sticky; top:0; z-index:5;
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,90,166,.12);
      padding: calc(env(safe-area-inset-top) + 10px) var(--space) 10px;
    }

    /* L√≠nea rom√°ntica suave arriba de la topbar */
    header.topbar::before{
      content:"";
      display:block;
      height:10px;
      border-radius:999px;
      background:
        radial-gradient(circle, rgba(255,90,166,.85) 0 3px, transparent 4px) 0 0/22px 10px,
        radial-gradient(circle, rgba(255,143,193,.75) 0 3px, transparent 4px) 11px 0/22px 10px,
        radial-gradient(circle, rgba(243,214,255,.75) 0 3px, transparent 4px) 0 0/22px 10px;
      opacity:.7;
      margin-bottom:8px;
    }

    .brand{
      font-weight:900;
      color:var(--text);
      text-align:center;
      font-size: clamp(16px, 4.8vw, 18px);
      letter-spacing:.2px;
    }
    .brand small{
      display:inline-block;
      margin-left:8px;
      font-weight:900;
      color:var(--pink2);
      background: rgba(255,209,230,.55);
      border: 1px solid rgba(255,90,166,.18);
      padding: 2px 10px;
      border-radius:999px;
      font-size: .78em;
      transform: translateY(-1px);
    }

    .container{
      width:100%;
      max-width: 820px;
      margin: var(--space) auto calc(var(--space-lg) * 2);
      padding-inline: max(var(--space), env(safe-area-inset-left));
    }

    .card{
      background:var(--card);
      border:1px solid rgba(255,90,166,.12);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding: var(--space);
      position:relative;
      overflow:hidden;
    }

    /* Detalle sutil en el borde de la card */
    .card::before{
      content:"";
      position:absolute;
      inset:auto 0 0 0;
      height:6px;
      background: linear-gradient(90deg, var(--lilac), var(--rose), var(--pink2));
      opacity:.75;
    }

    h2{
      margin: 4px 0 var(--space);
      color: var(--pink2);
      font-size: clamp(18px, 5.6vw, 22px);
      text-wrap: balance;
    }

    .listado{display:grid; gap: clamp(10px,3.2vw,14px)}

    .item{
      padding: clamp(12px,3.6vw,16px);
      border:1px solid rgba(255,90,166,.12);
      border-radius:14px;
      background:#fff;
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
    }

    .item h3{
      margin:0 0 6px;
      color: var(--pink2);
      font-weight:800;
      font-size: clamp(16px, 4.8vw, 18px);
      line-height:1.2;
      text-wrap: balance;
    }

    .meta{
      color:var(--muted);
      font-size: clamp(12px,3.8vw,14px)
    }

    .contenido{
      margin-top: 8px;
      line-height: 1.75;
      font-size: clamp(15px, 4.6vw, 17px);
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Banner rom√°ntico */
    .banner{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      margin-bottom: var(--space);
      background: linear-gradient(90deg, rgba(255,143,193,.12), rgba(243,214,255,.14), rgba(255,209,230,.14));
      border: 1px solid rgba(255,90,166,.12);
      color: var(--text);
      font-weight: 750;
      text-align:center;
    }
    .banner span{
      color: var(--pink2);
      font-weight: 900;
    }

    .footer{
      padding: calc(var(--space-lg) + env(safe-area-inset-bottom)) var(--space);
      text-align:center;
      color:var(--muted);
      font-size: clamp(12px,3.6vw,14px);
    }

    :focus-visible{
      outline: 3px solid var(--ring);
      outline-offset: 2px;
      border-radius:10px
    }
    a,button{ -webkit-tap-highlight-color: transparent }

    @media (max-width: 380px){
      .splash-card{padding: 14px}
      .item{padding: 12px}
    }
    @media (prefers-reduced-motion: reduce){
      body::before{animation:none}
      .splash{transition:none}
    }
  </style>
</head>

<body>
  <div class="splash" id="splash">
    <div class="splash-card">
      <h1>Para vos ‚ù§Ô∏è</h1>
      <p>(tocame para abrir üíå)</p>
      <button id="openBtn" class="btn">Abrir</button>
    </div>
  </div>

  <header class="topbar">
    <div class="brand">Mensajitos de amor <small>üíó 2026</small></div>
  </header>

  <main class="container">
    <section class="card">
      <div class="banner" id="loveBanner">‚ú® <span>Amor</span> ‚Äî mensajitos para vos üíû</div>

      <h2>Tus Mensajes</h2>
      <div id="listado" class="listado"></div>
      <p class="meta" id="estado">Cargando‚Ä¶</p>
    </section>
  </main>

  <footer class="footer">Hecho con üíñ por Tu novio Hermoso</footer>

  <script>
    const FEED_URL = "https://gist.githubusercontent.com/Int-Code-UY/ee642cb9278f57311196c31e500e28df/raw/cartas.json";
    const splash = document.getElementById('splash');
    const openBtn = document.getElementById('openBtn');
    openBtn.addEventListener('click', ()=> splash.classList.add('hide'));
    splash.addEventListener('click', (e)=>{ if(e.target===splash) splash.classList.add('hide'); });

    const listado = document.getElementById('listado');
    const estado  = document.getElementById('estado');

    const TZ = 'America/Montevideo';
    function parseDateSafe(input) {
      if (!input) return null;
      if (/^\d{4}-\d{2}-\d{2}$/.test(input)) {
        const [y, m, d] = input.split('-').map(Number);
        return new Date(y, m - 1, d);
      }
      const d2 = new Date(input);
      return Number.isNaN(d2.getTime()) ? null : d2;
    }
    function formatearFecha(f) {
      const d = parseDateSafe(f);
      if (!d) return '';
      return new Intl.DateTimeFormat('es-UY', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        timeZone: TZ
      }).format(d);
    }

    async function cargarCartas(){
      try{
        const url = `${FEED_URL}?t=${Date.now()}`;
        const res = await fetch(url, { cache: 'no-store' });
        if(!res.ok) throw new Error('No pude leer el feed');
        const cartas = await res.json();

        listado.innerHTML = '';
        cartas.forEach(c => {
          const item = document.createElement('div');
          item.className = 'item';
          item.innerHTML = `
            <h3>${esc(c.titulo || 'Sin t√≠tulo')}</h3>
            <div class="meta">${esc(formatearFecha(c.fecha))}</div>
            <div class="contenido">${renderContenido(c.contenido)}</div>
          `;
          listado.appendChild(item);
        });
        estado.textContent = cartas.length ? '' : 'A√∫n no hay cartas';
      }catch(err){
        estado.textContent = 'Sin conexi√≥n o feed no disponible.';
        console.error(err);
      }
    }

    function esc(s){ return String(s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function renderContenido(s){ return esc(String(s ?? '')).replace(/\n/g,'<br>'); }

    cargarCartas();
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) cargarCartas(); });
    window.addEventListener('pageshow', (e)=>{ if(e.persisted) cargarCartas(); });

    if('serviceWorker' in navigator){
      const code = `
        const C='carta-shell-v2';
        self.addEventListener('install',e=>{e.waitUntil(caches.open(C).then(c=>c.addAll(['./','./index.html'])));});
        self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(keys=>Promise.all(keys.map(k=>k!==C&&caches.delete(k)))));});
        self.addEventListener('fetch',e=>{
          const u=new URL(e.request.url);
          if(u.origin===location.origin){ e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))); }
        });
      `;
      const blob = new Blob([code], {type:'text/javascript'});
      const url = URL.createObjectURL(blob);
      navigator.serviceWorker.register(url);
    }
  </script>
</body>
</html>





